# Klipper Buzzer Configuration
# Add this to your printer.cfg or include it as a separate file

# Buzzer configuration for different printer boards
# Uncomment the section that matches your board

# Ender 3 V2 (Creality 4.2.2/4.2.7 board)
[output_pin buzzer]
pin: PC6  # Buzzer pin on Creality 4.2.x boards
pwm: True
shutdown_value: 0
value: 0
cycle_time: 0.001

# Alternative for older Creality boards (1.1.x)
# [output_pin buzzer]
# pin: PB0  # Buzzer pin on older Creality boards
# pwm: True
# shutdown_value: 0
# value: 0
# cycle_time: 0.001

# SKR Mini E3 V2.0/V3.0
# [output_pin buzzer]
# pin: PC9  # Buzzer pin on SKR Mini E3
# pwm: True
# shutdown_value: 0
# value: 0
# cycle_time: 0.001

# Generic Arduino/RAMPS (if using Marlin pin names)
# [output_pin buzzer]
# pin: ar37  # Only if your Klipper config uses Arduino pin names
# pwm: True
# shutdown_value: 0
# value: 0
# cycle_time: 0.001

# BEEP macro for LCD interface
[gcode_macro BEEP]
gcode:
    {% set frequency = params.FREQUENCY|default(1000)|int %}
    {% set duration = params.DURATION|default(0.1)|float %}
    
    # Calculate PWM value for frequency (approximate)
    {% set pwm_value = (frequency / 2000.0)|float %}
    {% if pwm_value > 1.0 %}
        {% set pwm_value = 1.0 %}
    {% endif %}
    
    # Play tone
    SET_PIN PIN=buzzer VALUE={pwm_value}
    G4 P{duration * 1000}  # Wait in milliseconds
    SET_PIN PIN=buzzer VALUE=0

# Alternative simple BEEP macro for digital buzzers
[gcode_macro BEEP_SIMPLE]
gcode:
    {% set duration = params.DURATION|default(0.1)|float %}
    
    SET_PIN PIN=buzzer VALUE=1
    G4 P{duration * 1000}
    SET_PIN PIN=buzzer VALUE=0

# Test macro - use this to test your buzzer
[gcode_macro TEST_BUZZER]
gcode:
    RESPOND MSG="Testing buzzer..."
    BEEP FREQUENCY=1000 DURATION=0.2
    G4 P200
    BEEP FREQUENCY=1500 DURATION=0.2
    G4 P200
    BEEP FREQUENCY=2000 DURATION=0.2
    RESPOND MSG="Buzzer test complete"

# Usage examples:
# BEEP                           # Default 1000Hz for 0.1s
# BEEP FREQUENCY=800 DURATION=0.5  # 800Hz for 0.5s
# TEST_BUZZER                    # Test sequence

# Troubleshooting:
# 1. Check if buzzer pin is correct for your board
# 2. Try without PWM (set pwm: False) for simple buzzers
# 3. Check if pin is inverted (add ! before pin name)
# 4. Verify buzzer works: SET_PIN PIN=buzzer VALUE=1